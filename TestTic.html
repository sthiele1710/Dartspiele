<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dart Tic Tac Toe</title>

<style>
body {
    font-family: sans-serif;
    background: #f5f5f5;
    margin: 0;
    padding: 10px;
    text-align: center;
}

h1 { margin: 5px 0; }

#status {
    margin: 10px auto;
    max-width: 420px;
    display: flex;
    justify-content: space-between;
    font-size: 18px;
}

.player1 { color: red; font-weight: bold; }
.player2 { color: blue; font-weight: bold; }

#controls {
    margin: 10px auto;
    max-width: 420px;
}

#controls .row {
    display: flex;
    justify-content: center;
    margin-bottom: 6px;
}

#controls button {
    flex: 1;
    padding: 15px;
    font-size: 18px;
    margin: 4px;
    border: none;
    border-radius: 8px;
    min-width: 80px;
}

#controls button.active {
    background: gold;
    font-weight: bold;
}

#board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    max-width: 420px;
    margin: 10px auto;
}

.cell {
    background: white;
    border-radius: 6px;
    min-height: 100px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    cursor: pointer;
}

.number { font-size: 24px; font-weight: bold; }
.x_hits, .o_hits { color: #bbb; }

.complete {
    font-size: 70px;
    font-weight: bold;
}

.winner {
    background: #fff2a8;
}

/* Zug beenden Button */
#passBtn {
    padding: 15px;
    font-size: 18px;
    margin-top: 10px;
    border-radius: 8px;
    background-color: #ff6666;
    color: white;
    font-weight: bold;
    max-width: 420px;
    width: 100%;
}
</style>
</head>

<body>

<h1>üéØ Dart Tic Tac Toe</h1>

<div id="status">
    <span id="player1" class="player1">Spieler 1 (X)</span>
    <span id="player2" class="player2">Spieler 2 (O)</span>
</div>

<div id="controls">
    <div class="row">
        <button id="singleBtn" onclick="setMultiplier(1)">Single</button>
        <button id="doubleBtn" onclick="setMultiplier(2)">Double</button>
        <button id="tripleBtn" onclick="setMultiplier(3)">Triple</button>
    </div>
    <div class="row">
        <button onclick="confirmReset(false)">Reset</button>
        <button onclick="confirmReset(true)">Reset (25)</button>
        <button onclick="undo()">‚Ü©Ô∏è R√ºckg√§ngig</button>
    </div>
</div>

<div id="board"></div>

<button id="passBtn" onclick="passTurn()">Zug beenden</button>

<script>
let fieldNumbers = [];
let p1 = Array(9).fill(0);
let p2 = Array(9).fill(0);
let currentPlayer = 1;
let throwsLeft = 3;
let multiplier = 1;
let gameOver = false;
let winningCombo = [];
let history = [];

/* ---------- STATE ---------- */
function snapshot() {
    history.push(JSON.parse(JSON.stringify({
        p1, p2, currentPlayer, throwsLeft, multiplier, gameOver, winningCombo
    })));
}

function undo() {
    if (!history.length) return;
    const s = history.pop();
    p1 = s.p1;
    p2 = s.p2;
    currentPlayer = s.currentPlayer;
    throwsLeft = s.throwsLeft;
    multiplier = s.multiplier;
    gameOver = s.gameOver;
    winningCombo = s.winningCombo;
    updateUI();
}

/* ---------- RESET ---------- */
function confirmReset(hard) {
    if (confirm("Spiel wirklich zur√ºcksetzen?")) resetGame(hard);
}

function resetGame(hard=false) {
    history = [];
    const nums = [...Array(20).keys()].map(i=>i+1).concat([25]);
    if (hard) {
        const others = nums.filter(n=>n!==25).sort(()=>Math.random()-0.5).slice(0,8);
        fieldNumbers = Array.from({length:9},(_,i)=>i===4?25:others.pop());
    } else {
        fieldNumbers = nums.sort(()=>Math.random()-0.5).slice(0,9);
    }

    p1.fill(0); p2.fill(0);
    currentPlayer = 1;
    throwsLeft = 3;
    multiplier = 1;
    gameOver = false;
    winningCombo = [];
    updateUI();
}

/* ---------- UI ---------- */
function updateStatus() {
    const statusDiv = document.getElementById("status");
    statusDiv.innerHTML = `
        <span class="${currentPlayer===1?'player1':''}">Spieler 1 (X)</span>
        <span class="${currentPlayer===2?'player2':''}">Spieler 2 (O)</span>
    `;
    if(document.getElementById("throwsLeft")==null){
        const span = document.createElement("div");
        span.id="throwsLeft";
        span.style.marginTop="6px";
        span.style.fontSize="18px";
        statusDiv.appendChild(span);
    }
    document.getElementById("throwsLeft").innerHTML = `W√ºrfe √ºbrig: <strong>${throwsLeft}</strong>`;
}

function setMultiplier(m) {
    multiplier = m;
    document.getElementById("singleBtn").classList.toggle("active", m===1);
    document.getElementById("doubleBtn").classList.toggle("active", m===2);
    document.getElementById("tripleBtn").classList.toggle("active", m===3);
}

function renderBoard() {
    const board = document.getElementById("board");
    board.innerHTML = "";
    for (let i=0;i<9;i++) {
        const c = document.createElement("div");
        c.className = "cell";
        if (winningCombo.includes(i)) c.classList.add("winner");

        if (p1[i]>=4) c.innerHTML = `<div class="complete">X</div>`;
        else if (p2[i]>=4) c.innerHTML = `<div class="complete">O</div>`;
        else c.innerHTML = `
            <div class="x_hits">${"X".repeat(p1[i])}</div>
            <div class="number">${fieldNumbers[i]}</div>
            <div class="o_hits">${"O".repeat(p2[i])}</div>
        `;

        c.onclick = ()=>clickField(i);
        board.appendChild(c);
    }
}

/* ---------- GAMEPLAY ---------- */
function clickField(idx) {
    if (gameOver) return;
    if (fieldNumbers[idx] === 25 && multiplier === 3) return;

    snapshot();
    if (currentPlayer === 1) p1[idx] += multiplier;
    else p2[idx] += multiplier;

    throwsLeft--;
    endThrow();
}

function endThrow() {
    multiplier = 1;
    setMultiplier(1);

    if (throwsLeft === 0) {
        currentPlayer = currentPlayer === 1 ? 2 : 1;
        throwsLeft = 3;
    }
    checkWin();
    updateUI();
}

/* ---------- PASS TURN ---------- */
function passTurn() {
    if (gameOver) return;
    snapshot();
    throwsLeft = 0;
    endThrow();
}

function checkWin() {
    const wins = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
    ];
    for (const w of wins) {
        if (w.every(i=>p1[i]>=4)||w.every(i=>p2[i]>=4)) {
            winningCombo = w;
            gameOver = true;
        }
    }
}

function updateUI() {
    updateStatus();
    renderBoard();
}

/* ---------- STOP DOUBLE-TAP ZOOM ---------- */
let lastTouch = 0;
document.addEventListener('touchstart', function(e) {
    const now = new Date().getTime();
    if (now - lastTouch <= 300) { // Doppeltap innerhalb 300ms blockieren
        e.preventDefault();
    }
    lastTouch = now;
}, { passive: false });

/* ---------- START ---------- */
resetGame();
</script>

</body>
</html>